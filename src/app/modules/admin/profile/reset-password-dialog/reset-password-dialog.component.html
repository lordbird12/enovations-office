<h2 mat-dialog-title class="text-xl font-bold">รีเซ็ตรหัสผ่าน</h2>

<div mat-dialog-content>
    <form [formGroup]="form" class="flex flex-col gap-4">
        <mat-form-field class="w-full">
            <mat-label>รหัสผ่านเดิม</mat-label>
            <input matInput [type]="hideOld ? 'password' : 'text'" formControlName="oldPassword" />
            <button mat-icon-button type="button" matSuffix (click)="hideOld = !hideOld">
                <mat-icon [svgIcon]="hideOld ? 'heroicons_solid:eye' : 'heroicons_solid:eye-slash'"></mat-icon>
            </button>
            <mat-error *ngIf="form.get('oldPassword')?.hasError('required')">กรุณากรอกรหัสผ่านเดิม</mat-error>
        </mat-form-field>

        <mat-form-field class="w-full">
            <mat-label>รหัสผ่านใหม่</mat-label>
            <input matInput [type]="hideNew ? 'password' : 'text'" formControlName="newPassword" />
            <button mat-icon-button type="button" matSuffix (click)="hideNew = !hideNew">
                <mat-icon [svgIcon]="hideNew ? 'heroicons_solid:eye' : 'heroicons_solid:eye-slash'"></mat-icon>
            </button>
            <mat-error *ngIf="form.get('newPassword')?.hasError('required')">กรุณากรอกรหัสผ่านใหม่</mat-error>
        </mat-form-field>

        <mat-form-field class="w-full">
            <mat-label>ยืนยันรหัสผ่านใหม่</mat-label>
            <input matInput [type]="hideConfirm ? 'password' : 'text'" formControlName="confirmPassword" />
            <button mat-icon-button type="button" matSuffix (click)="hideConfirm = !hideConfirm">
                <mat-icon [svgIcon]="hideConfirm ? 'heroicons_solid:eye' : 'heroicons_solid:eye-slash'"></mat-icon>
            </button>
            <mat-error *ngIf="form.get('confirmPassword')?.hasError('required')">กรุณายืนยันรหัสผ่านใหม่</mat-error>
            <mat-error *ngIf="form.hasError('mustMatch')">รหัสผ่านใหม่ไม่ตรงกัน</mat-error>
        </mat-form-field>

        <div *ngIf="form.hasError('endpointNotFound')" class="text-sm text-red-600">
            ไม่พบ endpoint สำหรับเปลี่ยนรหัสผ่านบนระบบ backend (ลองแล้ว: /api/change_password, /api/reset_password, /api/update_password)
        </div>
        <div *ngIf="form.hasError('serverError')" class="text-sm text-red-600">
            {{ form.getError('serverError') }}
        </div>
    </form>
</div>

<div mat-dialog-actions align="end" class="gap-2">
    <button mat-stroked-button (click)="close()">ยกเลิก</button>
    <button mat-flat-button color="primary" (click)="submit()" [disabled]="isSubmitting">
        บันทึก
    </button>
</div>
