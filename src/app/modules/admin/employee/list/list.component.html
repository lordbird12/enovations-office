<div class="flex flex-col flex-auto min-w-0">
    <!-- Header -->
    <!-- Loader -->
    <div class="fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-10 pointer-events-none" *ngIf="isLoading">
        <mat-spinner class="pointer-events-auto"></mat-spinner>
    </div>
    <div
        class="flex flex-col sm:flex-row flex-0 sm:items-center sm:justify-between p-6 sm:py-8 sm:px-10 border-b bg-card dark:bg-transparent">
        <div class="flex-1 flex min-w-0 items-start sm:items-center justify-between gap-4">
            <div class="min-w-0">
                <h2 class="text-3xl md:text-4xl font-extrabold tracking-tight leading-7 sm:leading-10 truncate">
                    รายการพนักงาน
                </h2>
                <div class="mt-1 text-sm text-gray-600 dark:text-gray-400">
                    ทั้งหมด {{ totalRecords }} รายการ
                </div>
            </div>

            <div class="flex flex-wrap items-center justify-end gap-2">
                <button class="px-6" mat-stroked-button color="primary" (click)="openDialogImort()">
                    <mat-icon svgIcon="heroicons_outline:plus-small"></mat-icon>
                    <span class="ml-2">นำเข้าข้อมูล</span>
                </button>
                <button class="px-6" mat-flat-button [color]="'primary'" (click)="addElement()">
                    <mat-icon svgIcon="heroicons_outline:plus-small"></mat-icon>
                    <span class="ml-2">เพิ่มข้อมูล</span>
                </button>
            </div>
        </div>
    </div>
    <!-- Main -->
    <div class="relative overflow-x-auto shadow-md sm:rounded-lg m-10 bg-card">
        <div class="flex flex-col flex-auto p-5 sm:overflow-y-auto">
            <table datatable [dtOptions]="dtOptions" class="table row-border hover w-full whitespace-nowrap">
                <thead>
                    <tr>
                        <th class="w-[160px]">
                            <div class="flex items-center gap-2">
                                <mat-checkbox [checked]="checkAll" [indeterminate]="someCheck"
                                    (change)="setAll($event.checked)" color="primary"></mat-checkbox>
                                <span>จัดการ</span>
                            </div>
                        </th>
                        <th class="w-[10px]">ลำดับ</th>
                        <th>พนักงาน</th>
                        <th>อีเมล</th>
                        <th>เบอร์ติดต่อ</th>
                        <th>สร้างโดย</th>
                        <th class="text-center">วันที่สร้าง</th>
                    </tr>
                </thead>
                <tbody *ngIf="dataRow?.length != 0">
                    <tr *ngFor="let item of dataRow; let i = index; trackBy: trackById">
                        <td>
                            <div class="flex items-center gap-1">
                                <mat-checkbox color="primary" [(ngModel)]="item.checked"></mat-checkbox>
                                <button
                                    mat-icon-button
                                    [matMenuTriggerFor]="rowMenu"
                                    [matMenuTriggerData]="{ item: item }"
                                    aria-label="เมนูจัดการ">
                                    <mat-icon svgIcon="heroicons_solid:cog-6-tooth"></mat-icon>
                                </button>
                            </div>
                        </td>
                        <td>{{ pages.begin + (i + 1) }}</td>
                        <td>
                            <div class="flex items-center gap-3">
                                <div class="h-10 w-10 rounded-full overflow-hidden bg-gray-100 ring-1 ring-gray-200">
                                    <img
                                        class="h-full w-full object-cover object-center"
                                        [src]="item.image || 'assets/images/no_image.png'"
                                        [alt]="item.name || 'employee'"
                                        (error)="onImageError($event)">
                                </div>
                                <div class="min-w-0">
                                    <div class="font-medium text-gray-900 dark:text-gray-100 truncate">
                                        {{ item.name ? item.name : "-" }}
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td>{{ item.email ? item.email : "-" }}</td>
                        <td>{{ item.tel ? item.tel : "-" }}</td>
                        <td>{{ item.create_by ? item.create_by : "-" }}</td>
                        <td class="text-center">
                            <ng-container *ngIf="toDate(item.created_at) as createdAt; else noCreatedAt">
                                {{ createdAt | date : 'dd-MM-yy, HH:mm' }}
                            </ng-container>
                            <ng-template #noCreatedAt>-</ng-template>
                        </td>
                    </tr>
                </tbody>
                <tbody *ngIf="dataRow?.length == 0">
                    <tr>
                        <td colspan="7" class="no-data-available text-center py-8 text-gray-500">
                            ไม่มีข้อมูล
                        </td>
                    </tr>
                </tbody>
            </table>

            <mat-menu #rowMenu="matMenu">
                <ng-template matMenuContent let-item="item">
                    <button mat-menu-item (click)="editElement(item)">
                        <mat-icon>edit</mat-icon>
                        <span>แก้ไข</span>
                    </button>
                    <button mat-menu-item (click)="deleteElement(item)">
                        <mat-icon>delete</mat-icon>
                        <span>ลบ</span>
                    </button>
                </ng-template>
            </mat-menu>
        </div>
    </div>
    <div *ngIf="someOneChecked?.length"
        class="flex items-center justify-between w-full border-t mt-8 px-8 py-5 bg-white dark:bg-gray-700 sticky bottom-0 h-24">
        <button class="rounded-md border-black border min-w-36" mat-stroked-button (click)="cancelCheck()">
            ยกเลิก
        </button>
        <span class="text-lg font-bold mx-5">เลือกแล้ว {{someOneChecked.length}}</span>
        <button class="inline-flex rounded-md min-w-36" mat-flat-button [color]="'primary'" (click)="confirmDelete()">
            <mat-icon>delete</mat-icon>
            <span class="ml-2">ลบรายการ</span>
        </button>
    </div>
</div>